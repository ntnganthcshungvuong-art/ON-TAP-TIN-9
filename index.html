<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>√în t·∫≠p Cu·ªëi HKI ‚Äì Tin h·ªçc 9</title>
  <style>
  :root{
    --bg1:#eef6ff;          /* xanh r·∫•t nh·∫°t */
    --bg2:#f7fbff;          /* tr·∫Øng xanh */
    --card:rgba(255,255,255,.92);
    --ink:#0f172a;
    --muted:#475569;
    --sky:#0ea5e9;
    --sky-100:#e0f2fe;
    --green:#10b981;
    --red:#ef4444;
    --amber:#f59e0b;
    --border:#dbeafe;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    color:var(--ink);
    font:16px/1.6 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    background:
      radial-gradient(1200px 600px at 20% 0%, #dbeafe 0%, rgba(219,234,254,0) 60%),
      radial-gradient(900px 500px at 90% 10%, #e0f2fe 0%, rgba(224,242,254,0) 55%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
  }
  .container{max-width:980px;margin:32px auto;padding:0 16px}
  h1{margin:8px 0 6px;font-weight:900;letter-spacing:.2px}
  .sub{color:var(--muted);margin-bottom:12px}

  .toolbar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 18px;align-items:center}
  .btn{
    border:1px solid var(--border);
    border-radius:12px;
    padding:10px 14px;
    background:rgba(224,242,254,.75);
    color:#0c4a6e;
    cursor:pointer;
    backdrop-filter: blur(6px);
  }
  .btn:hover{filter:brightness(0.99)}
  .btn.primary{
    background:linear-gradient(135deg, #0ea5e9, #38bdf8);
    color:#fff;
    border-color:transparent;
  }
  .btn.warn{background:#fff7ed;color:#9a3412;border:1px solid #fed7aa}

  .card{
    background:var(--card);
    border:1px solid rgba(219,234,254,.9);
    border-radius:16px;
    padding:18px;
    margin:14px 0;
    box-shadow:0 10px 30px rgba(2,8,23,.08);
    backdrop-filter: blur(8px);
  }
  .q-title{font-weight:800;margin-bottom:10px}
  .q-img{max-width:100%;height:auto;display:block;margin:10px 0;border-radius:12px;border:1px solid #e2e8f0}

  .opt{display:flex;gap:8px;align-items:flex-start;margin:6px 0;padding:10px;border-radius:12px;transition:.15s;border:1px solid transparent}
  .opt:hover{background:rgba(239,246,255,.7);border-color:rgba(191,219,254,.8)}
  .opt img{max-width:100%;height:auto;display:block;border-radius:12px;border:1px solid #e2e8f0}

  .muted{color:var(--muted)}
  .pill{display:inline-flex;align-items:center;gap:6px;font-size:13px;border-radius:999px;padding:4px 10px;background:rgba(224,231,255,.8);color:#3730a3;border:1px solid rgba(199,210,254,.9)}
  .score{font-weight:900}
  .good{color:var(--green)} .bad{color:var(--red)} .warnTxt{color:var(--amber)}

  .error{background:#fee2e2;border:1px solid #fecaca;color:#7f1d1d;padding:12px;border-radius:12px}
  .tiny{font-size:13px}

  .hint{display:none;margin-top:10px;padding:12px;border-radius:14px;background:rgba(248,250,252,.9);border:1px dashed #cbd5e1}
  .hint.show{display:block}
</style>

</head>
<body>
  <div class="container">
    <h1>√în T·∫≠p Cu·ªëi H·ªçc K·ª≥ I ‚Äì Tin h·ªçc 9</h1>
    <div class="sub">Tr·∫Øc nghi·ªám (28 c√¢u). C√≥ x√°o c√¢u/ƒë√°p √°n, ch·∫•m ƒëi·ªÉm, g·ª£i √Ω ki·∫øn th·ª©c c√¥ ƒë·ªçng.</div>

    <div class="toolbar">
      <button id="btnRetryNoShuffle" class="btn">üîÅ L√†m l·∫°i (gi·ªØ th·ª© t·ª±)</button>
      <button id="btnRetryShuffle" class="btn">üé≤ L√†m l·∫°i (x√°o c√¢u &amp; ƒë√°p √°n)</button>
      <button id="btnGrade" class="btn primary">‚úÖ Ch·∫•m ƒëi·ªÉm</button>
      <button id="btnClearMarks" class="btn warn">üßπ X√≥a nh√£n ƒë√∫ng/sai</button>
      <span id="score" class="pill">ƒêi·ªÉm: <span class="score">0/0</span></span>
      <span id="status" class="muted tiny"></span>
    </div>

    <div id="quiz"></div>
  </div>

<script>
let ORIGINAL_DATA = null;
let CURRENT_DATA  = null;

const $  = (s, r=document)=>r.querySelector(s);
const $$ = (s, r=document)=>[...r.querySelectorAll(s)];
const clone = o => JSON.parse(JSON.stringify(o));

function escapeHtml(s){
  return String(s ?? '')
    .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
    .replaceAll('"','&quot;').replaceAll("'","&#039;");
}
function shuffleArray(a){
  for(let i=a.length-1;i>0;i--){
    const j=Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
}
function setStatus(msg){ $('#status').textContent = msg || ''; }
function setScore(c,t){ $('#score .score').textContent = `${c}/${t}`; }

async function loadData(){
  try{
    setStatus('ƒêang t·∫£i d·ªØ li·ªáu...');
    const res = await fetch('data/tin9.json?ts=' + Date.now(), {cache:'no-store'});
    if(!res.ok) throw new Error(`HTTP ${res.status} khi t·∫£i data/tin9.json`);
    const raw = await res.json();
    if(!raw || !Array.isArray(raw.mcqs)) throw new Error('JSON ph·∫£i c√≥ d·∫°ng { "mcqs": [ ... ] }');
    ORIGINAL_DATA = raw;
    render(ORIGINAL_DATA, false);
    setStatus('ƒê√£ t·∫£i xong.');
  }catch(err){
    console.error(err);
    $('#quiz').innerHTML = `
      <div class="card error">
        <b>L·ªói t·∫£i d·ªØ li·ªáu.</b>
        <div class="tiny">Ki·ªÉm tra <code>data/tin9.json</code> ƒë√∫ng v·ªã tr√≠ v√† JSON h·ª£p l·ªá.</div>
        <div class="tiny">Chi ti·∫øt: ${escapeHtml(err.message)}</div>
      </div>
    `;
    setStatus('L·ªói t·∫£i d·ªØ li·ªáu.');
    setScore(0,0);
  }
}

function shuffleOptions(q){
  const pairs = q.options.map((opt,i)=>({opt,i}));
  shuffleArray(pairs);
  q.options = pairs.map(p=>p.opt);
  q.answer  = pairs.findIndex(p=>p.i===q.answer);
}

function render(raw, doShuffle){
  const data = clone(raw);
  if(doShuffle){
    shuffleArray(data.mcqs);
    data.mcqs.forEach(shuffleOptions);
  }
  CURRENT_DATA = data;
  buildQuiz(CURRENT_DATA);
  clearMarks();
  setScore(0, CURRENT_DATA.mcqs.length);
  window.scrollTo({top:0, behavior:'smooth'});
}

function buildQuiz(data){
  const root = $('#quiz');
  root.innerHTML = `
    <div class="card">
      <div class="q-title">PH·∫¶N TR·∫ÆC NGHI·ªÜM</div>
      <div class="muted">Ch·ªçn 1 ƒë√°p √°n ƒë√∫ng cho m·ªói c√¢u. B·∫•m ‚ÄúG·ª£i √Ω‚Äù ƒë·ªÉ xem ki·∫øn th·ª©c li√™n quan.</div>
    </div>
  `;

  data.mcqs.forEach((q,idx)=>{
    const qid = `q${idx}`;
    const optsHtml = q.options.map((opt,oi)=>{
      const label = String.fromCharCode(65+oi);
      return `
        <label class="opt">
          <input type="radio" name="${qid}" value="${oi}">
          <span><b>${label}.</b> ${escapeHtml(opt.text ?? '')}</span>
        </label>
      `;
    }).join('');

    const hintText = q.hint || "√în l·∫°i ki·∫øn th·ª©c li√™n quan trong b√†i h·ªçc Tin h·ªçc 9.";

    const card = document.createElement('div');
    card.className = 'card';
    card.dataset.qindex = String(idx);
    card.innerHTML = `
      <div class="q-title">C√¢u ${idx+1}: ${escapeHtml(q.stem)}</div>
      <div>${optsHtml}</div>

      <div class="toolbar" style="margin-top:10px">
        <button class="btn hint-btn" type="button">üí° G·ª£i √Ω</button>
      </div>
      <div class="hint"><b>Ki·∫øn th·ª©c:</b> ${escapeHtml(hintText)}</div>

      <div class="result tiny muted" style="margin-top:10px"></div>
    `;
    root.appendChild(card);

    $('.hint-btn', card).addEventListener('click', ()=>{
      $('.hint', card).classList.toggle('show');
    });
  });
}

function clearMarks(){
  $$('.card[data-qindex]').forEach(card=>{
    const title = $('.q-title',card);
    const base = title.getAttribute('data-base-html');
    if(base) title.innerHTML = base;
    else title.setAttribute('data-base-html', title.innerHTML);
    $('.result',card).textContent='';
  });
}

function grade(){
  if(!CURRENT_DATA?.mcqs?.length) return;
  clearMarks();

  let correct=0;
  const total=CURRENT_DATA.mcqs.length;

  $$('.card[data-qindex]').forEach(card=>{
    const i = Number(card.dataset.qindex);
    const q = CURRENT_DATA.mcqs[i];

    const title = $('.q-title',card);
    const base = title.getAttribute('data-base-html') || title.innerHTML;

    const picked = card.querySelector(`input[name="q${i}"]:checked`);
    const pickedIndex = picked ? Number(picked.value) : null;
    const ans = Number(q.answer);

    if(pickedIndex===null){
      title.innerHTML = `${base} <span class="warnTxt">‚ö† Ch∆∞a ch·ªçn</span>`;
    }else if(pickedIndex===ans){
      correct++;
      title.innerHTML = `${base} <span class="good">‚úî ƒê√∫ng</span>`;
    }else{
      title.innerHTML = `${base} <span class="bad">‚úò Sai</span>`;
    }

    const correctLetter = String.fromCharCode(65+ans);
    const pickedLetter = pickedIndex===null ? '‚Äî' : String.fromCharCode(65+pickedIndex);
    $('.result',card).innerHTML = `ƒê√°p √°n ƒë√∫ng: <b>${correctLetter}</b> ‚Ä¢ B·∫°n ch·ªçn: <b>${pickedLetter}</b>`;
  });

  setScore(correct,total);
  setStatus(`ƒê√£ ch·∫•m: ${correct}/${total}`);
  window.scrollTo({top:0, behavior:'smooth'});
}

window.addEventListener('DOMContentLoaded', ()=>{
  $('#btnRetryNoShuffle').addEventListener('click', ()=> render(ORIGINAL_DATA,false));
  $('#btnRetryShuffle').addEventListener('click', ()=> render(ORIGINAL_DATA,true));
  $('#btnGrade').addEventListener('click', grade);
  $('#btnClearMarks').addEventListener('click', ()=>{
    clearMarks();
    setScore(0, CURRENT_DATA?.mcqs?.length ?? 0);
    setStatus('ƒê√£ x√≥a nh√£n.');
  });
  loadData();
});
</script>
</body>
</html>
